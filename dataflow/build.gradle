buildscript {
    repositories {
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }
    dependencies {
        classpath "com.github.jengelman.gradle.plugins:shadow:4.0.2"
    }
}

plugins {
    id 'java'
    id 'io.franzbecker.gradle-lombok' version '1.14'
    id 'jacoco'
}

apply plugin: "com.github.johnrengelman.shadow"

repositories {
    mavenCentral()
}

lombok {
    version = '1.18.4'
    sha256 = ""
}

jacoco {
    toolVersion = "0.8.2"
}

jar {
    manifest {
        attributes 'Main-Class': 'com.doit.Main'
    }
}

shadowJar {
    zip64 = true
}

archivesBaseName = 'nfl_data_flow.jar'

dependencies{
    compile "org.apache.beam:beam-runners-google-cloud-dataflow-java:2.9.0"
    compile "com.google.cloud.bigtable:bigtable-hbase-beam:1.5.0"
    compile "org.apache.beam:beam-sdks-java-core:2.9.0"
    compile "org.apache.beam:beam-runners-direct-java:2.9.0"
    compileOnly "org.projectlombok:lombok:1.18.4"

    testCompile "junit:junit:4.10"
    testCompile "org.reflections:reflections:0.9.11"
}

task deploy {
    doLast {
        exec {
            commandLine 'gsutil', 'cp', jar.archivePath.getAbsolutePath(), 'gs://nfl-raw-data/nfl_data_flow.jar'
        }
    }
}

deploy.dependsOn(shadowJar)
shadowJar.dependsOn(build)
